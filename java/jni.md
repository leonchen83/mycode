# NativeJemalloc.java

```
public class NativeJemalloc {
	
	static {
		System.loadLibrary("nje");
	}
	
	public static native void je_free(long ptr);
	
	public static native long je_malloc(long size);
	
	public static native void je_aligned_free(long ptr);
	
	public static native long je_calloc(long num, long size);
	
	public static native long je_realloc(long ptr, long size);
	
	public static native long je_aligned_alloc(long alignment, long size);
	
	public static void main(String[] args) {
		long addr = NativeJemalloc.je_malloc(1024);
		System.out.println(addr);
		NativeJemalloc.je_free(addr);
	}
}
```

# NativeJemalloc.h
```
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class NativeJemalloc */

#ifndef _Included_NativeJemalloc
#define _Included_NativeJemalloc
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     NativeJemalloc
 * Method:    je_free
 * Signature: (J)V
 */
JNIEXPORT void JNICALL Java_NativeJemalloc_je_1free
  (JNIEnv *, jclass, jlong);

/*
 * Class:     NativeJemalloc
 * Method:    je_malloc
 * Signature: (J)J
 */
JNIEXPORT jlong JNICALL Java_NativeJemalloc_je_1malloc
  (JNIEnv *, jclass, jlong);

/*
 * Class:     NativeJemalloc
 * Method:    je_aligned_free
 * Signature: (J)V
 */
JNIEXPORT void JNICALL Java_NativeJemalloc_je_1aligned_1free
  (JNIEnv *, jclass, jlong);

/*
 * Class:     NativeJemalloc
 * Method:    je_calloc
 * Signature: (JJ)J
 */
JNIEXPORT jlong JNICALL Java_NativeJemalloc_je_1calloc
  (JNIEnv *, jclass, jlong, jlong);

/*
 * Class:     NativeJemalloc
 * Method:    je_realloc
 * Signature: (JJ)J
 */
JNIEXPORT jlong JNICALL Java_NativeJemalloc_je_1realloc
  (JNIEnv *, jclass, jlong, jlong);

/*
 * Class:     NativeJemalloc
 * Method:    je_aligned_alloc
 * Signature: (JJ)J
 */
JNIEXPORT jlong JNICALL Java_NativeJemalloc_je_1aligned_1alloc
  (JNIEnv *, jclass, jlong, jlong);

#ifdef __cplusplus
}
#endif
#endif
```

# NativeJemalloc.c
```
#include <jni.h>
#include <stdio.h>
#include <jemalloc/jemalloc.h>
#include "NativeJemalloc.h"
/*
 * Class:     NativeJemalloc
 * Method:    je_free
 * Signature: (J)V
 */
JNIEXPORT void JNICALL Java_NativeJemalloc_je_1free(JNIEnv *env, jclass class, jlong ptr) {
    return;
}

/*
 * Class:     NativeJemalloc
 * Method:    je_malloc
 * Signature: (J)J
 */
JNIEXPORT jlong JNICALL Java_NativeJemalloc_je_1malloc(JNIEnv *env, jclass class, jlong size) {
    return (jlong)je_malloc(size);
}

/*
 * Class:     NativeJemalloc
 * Method:    je_aligned_free
 * Signature: (J)V
 */
JNIEXPORT void JNICALL Java_NativeJemalloc_je_1aligned_1free(JNIEnv *env, jclass class, jlong ptr) {
    return;
}

/*
 * Class:     NativeJemalloc
 * Method:    je_calloc
 * Signature: (JJ)J
 */
JNIEXPORT jlong JNICALL Java_NativeJemalloc_je_1calloc(JNIEnv *env, jclass class, jlong num, jlong size) {
    return 0;
}
/*
 * Class:     NativeJemalloc
 * Method:    je_realloc
 * Signature: (JJ)J
 */
JNIEXPORT jlong JNICALL Java_NativeJemalloc_je_1realloc(JNIEnv *env, jclass class, jlong ptr, jlong size) {
    return 0;
}

/*
 * Class:     NativeJemalloc
 * Method:    je_aligned_alloc
 * Signature: (JJ)J
 */
JNIEXPORT jlong JNICALL Java_NativeJemalloc_je_1aligned_1alloc(JNIEnv *env, jclass class, jlong alignment, jlong size) {
    return 0;
}
```

# compile
```
# gcc -c -fPIC NativeJemalloc.c -o NativeJemalloc.o -I"$JAVA_HOME/include" -I"$JAVA_HOME/include/linux" -I`jemalloc-config --includedir`
# gcc -shared -o libnje.so NativeJemalloc.o -Wl,-rpath,/usr/local/lib -L/usr/local/lib -ljemalloc
```

# run
```
javac NativeJemalloc.java
java -Djava.library.path=. NativeJemalloc
```
